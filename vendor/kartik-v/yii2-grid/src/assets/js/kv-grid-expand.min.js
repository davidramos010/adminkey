/*!
 * @package   yii2-grid
 * @author    Kartik Visweswaran <kartikv2@gmail.com>
 * @copyright Copyright &copy; Kartik Visweswaran, Krajee.com, 2014 - 2019
 * @version   3.3.4
 *
 * jQuery methods library for yii2-grid expand row column
 * 
 * Author: Kartik Visweswaran
 * Copyright: 2014 - 2019, Kartik Visweswaran, Krajee.com
 * For more JQuery plugins visit http://plugins.krajee.com
 * For more Yii related demos visit http://demos.krajee.com
 */var kvExpandRow;!function(e){"use strict";kvExpandRow=function(t,a){var n=".kvExpandRowColumn",l="kvRowNum_"+a,o=t.gridId,i=t.hiddenFromExport,d=t.detailUrl,r=t.onDetailLoaded,s=t.expandIcon,c=t.collapseIcon,p=t.expandTitle,v=t.collapseTitle,f=t.expandAllTitle,u=t.collapseAllTitle,x=t.expandOneOnly,h=t.enableRowClick,k=t.rowClickExcludedTags,g=t.enableCache,w=t.extraData,C=i?t.rowCssClass+" skip-export":t.rowCssClass,m=t.animationDuration,A=e("#"+o),y="."+a,b=A.find(".kv-expand-header-cell.kv-batch-toggle"+y),R=b.find(".kv-expand-header-icon"),E=void 0===t.collapseAll?!1:t.collapseAll,T=void 0===t.expandAll?!1:t.expandAll,I=A.find("td.kv-expand-icon-cell"+y+" .kv-expand-row:not(.kv-state-disabled)"),N=I.length,D="kv-expand-detail-loading",j=function(){var t=A.find("td.kv-expand-icon-cell"+y+":first"),a=t&&t.length?t.closest("tr"):"",n=0;return a&&a.length?(a.find("> td").each(function(){"none"!==e(this).css("display")&&n++}),n):0},O=j(),P=function(e){return e.hasClass("kv-state-collapsed")&&!e.hasClass("kv-state-disabled")},L=function(e){return e.hasClass("kv-state-expanded")&&!e.hasClass("kv-state-disabled")},S=function(e,t){e.length&&e.removeClass(t).addClass(t)},U=function(e){e.removeClass("kv-state-collapsed").addClass("kv-state-expanded")},F=function(e){e.removeClass("kv-state-expanded").addClass("kv-state-collapsed")},K=function(e){S(e,D)},Q=function(e){if(e.length){var t=isNaN(m)?1e3:m+200;setTimeout(function(){e.removeClass(D)},t)}},_=function(){var e=A.data(l);return e=e?parseInt(e):0,isNaN(e)?0:e},q=function(e){A.data(l,e)},z=function(){var e=_();A.data(l,e+1)},B=function(e,t,a,l){var o=l?t:t.split(" ").join(n+" ")+n;e.length&&e.off(o).on(o,a)};return A.data(l)||q(0),0===w.length&&(w={}),0===I.length?void S(b,"kv-state-disabled"):(I.each(function(){var a,n,l=e(this),o=l.find(">.kv-expand-icon"),i=o.closest(".kv-expand-icon-cell"),f=l.closest("tr"),u=i.find(".kv-expand-detail"),j=l.find(".kv-expanded-row"+y+":first"),S=j.data("key"),q=j.data("index");if(!P(o)&&!L(o))return!0;0===j.length&&(S=f.data("key"),a=f.next('tr.kv-expand-detail-row[data-key="'+S+'"]'),j=a.find(".kv-expanded-row"));var G=function(t){var a=e.extend({expandRowKey:S,expandRowInd:q},w),n=g?0===j.html().length:!0;return d.length>0&&n?void e.ajax({type:"POST",data:a,url:d,beforeSend:function(){K(i),A.trigger("kvexprow:beforeLoad",[q,S,w])},success:function(e){j.html(e),Q(i),"function"==typeof r&&r(),t(),A.trigger("kvexprow:loaded",[q,S,w])},error:function(){j.html('<div class="alert alert-danger">Error fetching data. Please try again later.</div>'),A.trigger("kvexprow:error",[q,S,w]),Q(i)}}):(Q(i),void t())},H=function(t){A.find('tr[data-index="'+q+'"]').remove(),j.hide(),f.after(j);var a='<tr class="kv-expand-detail-row '+C+'" data-key="'+S+'" data-index="'+q+'">';j.wrap('<td colspan="'+O+'">').parent().wrap(a),o.html(c),i.attr("title",v),t?j.slideDown(m,function(){F(o),j.show()}):(j.show(),F(o));var n=f.prevAll(),l=f.index()+1;n.push(f),e.each(n,function(t,a){var n=e(a).find("td[rowspan]");e.each(n,function(t,n){var o=parseInt(e(n).attr("rowspan"));e(a).index()+o>l&&e(n).attr("rowspan",o+1)})}),0===d.length&&Q(i)},J=function(){K(i),u.html(""),o.html(s),i.attr("title",p),n=j.closest(".kv-expand-detail-row"),j.slideUp(m,function(){j.unwrap().unwrap(),j.appendTo(u),U(o);var t=f.prevAll();t.push(f);var a=f.index()+1;e.each(t,function(t,n){var l=e(n).find("td[rowspan]");e.each(l,function(t,l){var o=parseInt(e(l).attr("rowspan"));e(n).index()+o>a&&e(l).attr("rowspan",o-1)})})}),Q(i)},M=function(){var a,n,l=!1,d=!1;if(!i.hasClass(D)){if(L(o)){if(n=x&&!E){if(a=e.extend({},t,{collapseAll:!0}),I.each(function(){return e(this).closest(".kv-expand-icon-cell").hasClass(D)?void(d=!0):void 0}),d)return;kvExpandRow(a),l=!0}return G(function(){H(!0)}),void(n&&!l||(A.trigger("kvexprow:toggle",[q,S,w,!0]),o.focus()))}P(o)&&(J(),A.trigger("kvexprow:toggle",[q,S,w,!1]),o.focus())}};return T?(L(o)&&G(function(){H(!0),z(),_()>=N&&(Q(b),R.focus())}),_()>=N&&(Q(b),R.focus()),!0):E?(P(o)&&(J(),z(),_()>=N&&(Q(b),R.focus())),_()>=N&&(Q(b),R.focus()),!0):(P(o)&&(d?G(function(){H(!1)}):H(!1)),B(i,"click",function(e){M(i),e.stopPropagation()}),void B(f,"click",function(t){var a=t.target,n=e(a).length&&e(a).hasClass("kv-disable-click")||-1!==e.inArray(a.nodeName,k);h&&!n&&M(i)}))}),void(b.length&&B(b,"click",function(){if(!b.hasClass(D)&&0!==I.length){var n=L(R),l=P(R),o=e.extend({},t,{expandAll:l,collapseAll:n});K(b),l?(q(I.find(".kv-state-collapsed").length),U(R),R.html(c),b.attr("title",u),A.trigger("kvexprow:toggleAll",[w,!1])):n&&(q(I.find(".kv-state-expanded").length),F(R),R.html(s),b.attr("title",f),A.trigger("kvexprow:toggleAll",[w,!0])),kvExpandRow(o,a)}})))}}(window.jQuery);